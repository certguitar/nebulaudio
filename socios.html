<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üë• Nebulaudio ‚Äî Tabla de Socios Compositores</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0a0a14;
      --bg-card: rgba(18, 18, 32, 0.65);
      --border-glow: rgba(16, 185, 129, 0.4);
      --text-primary: #f0f0ff;
      --text-secondary: #a0a0c0;
      --accent: #10b981;
      --accent2: #8b5cf6;
      --express: #64748b;
      --pro: #10b981;
      --studio: #8b5cf6;
      --paid: #10b981;
      --pending: #eab308;
      --locked: #64748b;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 1rem;
      text-align: center;
      background-image:
        linear-gradient(rgba(10, 10, 20, 0.75), rgba(10, 10, 20, 0.85)),
        url('https://i.postimg.cc/4ywDV4xc/universo-nebulaudio.png');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      position: relative;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08), transparent 40%),
                  radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.06), transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 1.2rem 0.8rem;
    }

    .logo-top {
      margin: 0 auto 1.4rem;
      max-width: 600px;
    }
    .logo-img {
      height: 80px;
      filter: drop-shadow(0 0 16px rgba(139, 92, 246, 0.5));
      margin: 0 auto 0.6rem;
    }
    .logo-top h1 {
      font-size: 1.8rem;
      font-weight: 800;
      margin: 0.3rem 0;
      background: linear-gradient(90deg, #10b981, #8b5cf6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .subtitle {
      font-size: 1.1rem;
      opacity: 0.85;
      margin: 0.5rem auto;
      max-width: 580px;
      line-height: 1.5;
    }

    /* Pantalla de acceso */
    #access-screen {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-dark);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(4px);
    }
    #access-screen h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, #10b981, #8b5cf6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    #access-form {
      background: rgba(18, 18, 32, 0.65);
      padding: 2rem;
      border-radius: 20px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    #access-form input {
      width: 100%;
      padding: 0.8rem;
      margin: 0.6rem 0;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      background: rgba(10,10,20,0.5);
      color: white;
      font-size: 1rem;
    }
    #access-form button {
      width: 100%;
      padding: 0.8rem;
      background: linear-gradient(135deg, var(--pro), #0d9a6d);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    #access-form button:hover {
      opacity: 0.9;
    }
    #access-error {
      color: #ef4444;
      font-size: 0.85rem;
      margin-top: 0.5rem;
      min-height: 1.2rem;
    }

    .card {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 1.5rem;
      margin: 1.4rem 0;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      text-align: left;
    }
    .card h2 {
      margin-bottom: 1.1rem;
      color: var(--pro);
      font-size: 1.4rem;
    }

    .table-container {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.92rem;
    }
    thead {
      background: rgba(16, 185, 129, 0.08);
    }
    th, td {
      padding: 0.75rem 0.6rem;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    th {
      font-weight: 600;
      color: var(--text-primary);
    }
    tbody tr:hover {
      background: rgba(255,255,255,0.03);
    }
    .amount { text-align: right; }
    .status-paid { color: var(--paid); font-weight: 600; }
    .status-pending { color: var(--pending); font-weight: 600; }
    .status-locked { color: var(--locked); opacity: 0.7; }
    .total-col { color: var(--accent2); font-weight: 700; }

    .controls {
      display: flex;
      gap: 0.8rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }
    .btn {
      padding: 0.6rem 1.2rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .btn-update {
      background: linear-gradient(135deg, var(--pro), #0d9a6d);
      color: white;
    }
    .btn-export {
      background: var(--express);
      color: white;
    }

    .footer {
      margin-top: 2rem;
      font-size: 0.76rem;
      opacity: 0.6;
      line-height: 1.5;
    }

    .empty-state {
      padding: 2rem;
      opacity: 0.6;
      font-style: italic;
    }

    /* Modal de autorizaci√≥n de tesorer√≠a */
    #auth-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 3000;
      justify-content: center;
      align-items: center;
    }
    #auth-modal-content {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
      position: relative;
    }
    #close-auth-modal {
      position: absolute;
      top: 1rem; right: 1rem;
      background: #334155;
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      font-weight: bold;
      cursor: pointer;
    }
    #treasury-key {
      width: 100%;
      padding: 0.7rem;
      margin: 0.8rem 0;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      background: rgba(10,10,20,0.5);
      color: white;
      font-family: 'Inter', sans-serif;
    }
    #auth-status {
      min-height: 1.2rem;
      font-size: 0.85rem;
      margin-top: 0.5rem;
      color: #ef4444;
    }

    /* ‚úÖ Formulario de edici√≥n (solo para admin) */
    #data-input-screen {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-dark);
      z-index: 2000;
      justify-content: center;
      align-items: flex-start;
      padding-top: 2rem;
      overflow-y: auto;
    }
    .input-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 2rem;
      max-width: 800px;
      width: 90%;
      margin: 0 auto;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    }
    .input-card h2 {
      margin-bottom: 1.2rem;
      color: var(--pro);
    }
    .composer-row {
      display: flex;
      gap: 0.8rem;
      margin-bottom: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .composer-row input {
      padding: 0.6rem;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      background: rgba(10,10,20,0.5);
      color: white;
      font-family: 'Inter', sans-serif;
    }
    .composer-name {
      flex: 2;
      min-width: 200px;
    }
    .composer-downloads, .composer-paid {
      flex: 1;
      min-width: 100px;
      text-align: center;
    }
    #add-composer-btn {
      background: rgba(16,185,129,0.1);
      color: var(--pro);
      border: 1px dashed var(--pro);
      padding: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #save-data-btn {
      background: linear-gradient(135deg, var(--pro), #0d9a6d);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 1rem;
    }

    /* Bot√≥n de acci√≥n tras autorizaci√≥n */
    .btn-mark-paid {
      padding: 4px 10px;
      font-size: 0.75rem;
      background: var(--pending);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-mark-paid:hover {
      background: #d97706;
    }
  </style>
</head>
<body>

  <!-- üö™ Pantalla de acceso -->
  <div id="access-screen">
    <div class="logo-top">
      <img src="https://i.postimg.cc/x1F9B5YQ/logo-nebulaudio.png" class="logo-img" alt="Nebulaudio">
      <h1>Nebulaudio</h1>
    </div>
    <div id="access-form">
      <h2>üîê Acceso restringido</h2>
      <p style="opacity:0.7; margin-bottom:1rem;">Solo para compositores registrados</p>
      <input type="password" id="access-key" placeholder="Clave de acceso" autocomplete="off">
      <button onclick="checkAccess()">Acceder</button>
      <div id="access-error"></div>
    </div>
  </div>

  <!-- ‚úÖ Formulario de edici√≥n (solo para ti) -->
  <div id="data-input-screen">
    <div class="input-card">
      <h2>‚úèÔ∏è Editar datos del mes ‚Äî Enero 2026</h2>
      <div id="composer-inputs">
        <div class="composer-row">
          <input type="text" class="composer-name" placeholder="Nombre del compositor" value="Carlos Reyes (CERT)">
          <input type="number" class="composer-downloads" placeholder="Descargas" value="42" min="0">
          <input type="number" class="composer-paid" placeholder="Pagado ($)" value="0.00" step="0.01" min="0">
        </div>
        <div class="composer-row">
          <input type="text" class="composer-name" placeholder="Nombre del compositor" value="Ana Mart√≠nez (I.B.)">
          <input type="number" class="composer-downloads" placeholder="Descargas" value="15" min="0">
          <input type="number" class="composer-paid" placeholder="Pagado ($)" value="19.13" step="0.01" min="0">
        </div>
      </div>
      <button id="add-composer-btn" onclick="addComposerRow()">‚ûï A√±adir compositor</button>
      <button id="save-data-btn" onclick="saveMonthlyData()">‚úÖ Guardar y volver a la tabla</button>
    </div>
  </div>

  <!-- üìä Contenido principal -->
  <div id="main-content" style="display:none;">
    <div class="container">
      <div class="logo-top">
        <h1>üë• Tabla de Socios Compositores</h1>
        <p class="subtitle">Transparencia total ‚Äî Enero 2026</p>
      </div>

      <div class="card">
        <h2>üìä Ranking de Socios</h2>
        <p style="opacity:0.85; margin-bottom:1rem;">
          Tu parte por obra: <strong>85% de $1.50 = $1.275</strong>.
        </p>

        <div class="controls">
          <button id="btn-edit" class="btn btn-update" style="display:none;" onclick="showDataInput()">‚úèÔ∏è Editar datos del mes</button>
          <button class="btn btn-export" onclick="exportCSV()">üì• Exportar CSV</button>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Compositor</th>
                <th>Obras</th>
                <th>Descargas</th>
                <th class="amount">Adeudado</th>
                <th class="amount">Pagado</th>
                <th class="amount">Total</th>
                <th>Acci√≥n</th>
              </tr>
            </thead>
            <tbody id="socios-table">
            </tbody>
          </table>
        </div>

        <div id="empty-message" class="empty-state" style="display:none;">
          üåå Sin datos. Usa "‚úèÔ∏è Editar datos del mes" para cargarlos.
        </div>
      </div>

      <p class="footer">¬© 2026 Nebulaudio</p>
    </div>
  </div>

  <!-- üîê Modal de tesorer√≠a -->
  <div id="auth-modal">
    <div id="auth-modal-content">
      <button id="close-auth-modal" onclick="closeAuthModal()">√ó</button>
      <h3>üîê Autorizaci√≥n de Tesorer√≠a</h3>
      <p>Ingresa la clave para habilitar marcar pagos.</p>
      <input type="password" id="treasury-key" placeholder="Clave de tesorer√≠a" onkeypress="if(event.key==='Enter') authorizePayment()">
      <button class="btn btn-update" onclick="authorizePayment()" style="width:100%;">‚úÖ Autorizar</button>
      <p id="auth-status"></p>
    </div>
  </div>

  <script>
  const KEY_SOCIO = "nebula2026";
  const KEY_ADMIN = "Cert$log171072";
  let currentData = null;
  let isAdmin = false;
  let isAuthorized = false;

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // ‚úèÔ∏è DATOS DEL MES ‚Äî Enero 2026
  // ‚ñº EDITA ESTE BLOQUE CUANDO AGREGUES/ACTUALICES COMPOSITORES ‚ñº
  // Formato: { name: "Nombre (Abrev.)", works: N, downloads: N, paid: N.NN }
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const MONTHLY_DATA = [
    { name: "Carlos Reyes (CERT)", works: 19, downloads: 42, paid: 0.00 },
    { name: "Ana Mart√≠nez (I.B.)", works: 2, downloads: 15, paid: 19.13 },
    { name: "JB",                 works: 0, downloads: 0,  paid: 0.00 }
    // Agrega m√°s aqu√≠ si lo deseas, por ejemplo:
    // { name: "Luis G√≥mez (L.G.)", works: 5, downloads: 7, paid: 0.00 }
  ];
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  function closeAuthModal() {
    document.getElementById('auth-modal').style.display = 'none';
  }

  function checkAccess() {
    const key = document.getElementById('access-key').value.trim();
    const error = document.getElementById('access-error');
    
    if (key === KEY_ADMIN) {
      isAdmin = true;
      document.getElementById('access-screen').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      document.getElementById('btn-edit').style.display = 'inline-block';
      currentData = JSON.parse(JSON.stringify(MONTHLY_DATA)); // ‚úÖ Usa datos fijos
      renderTable();
    } else if (key === KEY_SOCIO) {
      isAdmin = false;
      isAuthorized = false;
      document.getElementById('access-screen').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      currentData = JSON.parse(JSON.stringify(MONTHLY_DATA)); // ‚úÖ Mismos datos
      renderTable();
    } else {
      error.textContent = "‚ùå Clave incorrecta";
      document.getElementById('access-key').value = '';
      document.getElementById('access-key').focus();
    }
  }

  document.getElementById('access-key').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') checkAccess();
  });

  // === Edici√≥n (solo para admin) ===
  function showDataInput() {
    if (!isAdmin) return;
    // Precarga los datos actuales en el formulario
    const container = document.getElementById('composer-inputs');
    container.innerHTML = '';
    currentData.forEach(item => {
      const row = document.createElement('div');
      row.className = 'composer-row';
      row.innerHTML = `
        <input type="text" class="composer-name" placeholder="Nombre del compositor" value="${item.name}">
        <input type="number" class="composer-downloads" placeholder="Descargas" value="${item.downloads}" min="0">
        <input type="number" class="composer-paid" placeholder="Pagado ($)" value="${item.paid.toFixed(2)}" step="0.01" min="0">
      `;
      container.appendChild(row);
    });
    document.getElementById('data-input-screen').style.display = 'flex';
    document.getElementById('main-content').style.display = 'none';
  }

  function addComposerRow() {
    const container = document.getElementById('composer-inputs');
    const row = document.createElement('div');
    row.className = 'composer-row';
    row.innerHTML = `
      <input type="text" class="composer-name" placeholder="Nombre del compositor" value="">
      <input type="number" class="composer-downloads" placeholder="Descargas" value="0" min="0">
      <input type="number" class="composer-paid" placeholder="Pagado ($)" value="0.00" step="0.01" min="0">
    `;
    container.appendChild(row);
  }

  function saveMonthlyData() {
    if (!isAdmin) return;
    const rows = document.querySelectorAll('.composer-row');
    const newData = [];
    for (let row of rows) {
      const name = row.querySelector('.composer-name').value.trim();
      const downloads = parseInt(row.querySelector('.composer-downloads').value) || 0;
      const paid = parseFloat(row.querySelector('.composer-paid').value) || 0;
      const works = 0; // opcional: podr√≠as inferirlo o a√±adir campo
      if (name) newData.push({ name, works, downloads, paid });
    }

    // ‚úÖ Notifica al admin que debe actualizar MONTHLY_DATA manualmente
    const jsonStr = JSON.stringify(newData, null, 2);
    alert(
      "‚úÖ Datos guardados temporalmente.\n\n" +
      "‚ö†Ô∏è Para que TODOS los socios vean estos cambios:\n" +
      "1. Copia el JSON que aparece a continuaci√≥n.\n" +
      "2. Reemplaza el contenido de MONTHLY_DATA en socios.html.\n" +
      "3. Sube el archivo actualizado a GitHub.\n\n" +
      "üëá Haz clic en Aceptar y luego copia el JSON:"
    );
    const confirmed = confirm("¬øAbrir cuadro para copiar JSON ahora?");
    if (confirmed) {
      prompt("üìå Copia este JSON y p√©galo en MONTHLY_DATA:", jsonStr);
    }

    currentData = newData;
    document.getElementById('data-input-screen').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
    renderTable();
  }

  // === Tabla ===
  function renderTable() {
    if (!currentData || currentData.length === 0) {
      document.getElementById('empty-message').style.display = 'block';
      document.getElementById('socios-table').innerHTML = '';
      return;
    }

    document.getElementById('empty-message').style.display = 'none';
    const tbody = document.getElementById('socios-table');
    tbody.innerHTML = '';

    const sorted = [...currentData].sort((a, b) => {
      const totalA = a.downloads * 1.275;
      const totalB = b.downloads * 1.275;
      return (totalB - b.paid) - (totalA - a.paid); // Orden por adeudado descendente
    });

    sorted.forEach((item, idx) => {
      const totalEarn = item.downloads * 1.275;
      const pending = totalEarn - item.paid;
      const row = tbody.insertRow();

      let actionCell = '';
      if (isAdmin && isAuthorized && pending > 0) {
        actionCell = `<button class="btn-mark-paid" onclick="markAsPaid(${idx})">‚úÖ Marcar como pagado</button>`;
      } else if (isAdmin && !isAuthorized && pending > 0) {
        actionCell = `<button onclick="openAuthModal()" style="padding:4px 10px; font-size:0.75rem; background:var(--locked); color:white; border:none; border-radius:4px; opacity:0.4; cursor:pointer;">üîí Acceso restringido</button>`;
      } else {
        actionCell = `<span style="opacity:0.5;">üîí Acceso restringido</span>`;
      }

      row.innerHTML = `
        <td>${idx + 1}</td>
        <td>${item.name}</td>
        <td>${item.works > 0 ? item.works : '‚Äî'}</td>
        <td>${item.downloads}</td>
        <td class="amount ${pending > 0 ? 'status-pending' : 'status-paid'}">$${Math.max(0, pending).toFixed(2)}</td>
        <td class="amount status-paid">$${item.paid.toFixed(2)}</td>
        <td class="amount total-col">$${totalEarn.toFixed(2)}</td>
        <td>${actionCell}</td>
      `;
    });
  }

  // === Gesti√≥n de pagos ===
  function openAuthModal() {
    if (!isAdmin) return;
    document.getElementById('treasury-key').value = '';
    document.getElementById('auth-status').textContent = '';
    document.getElementById('auth-modal').style.display = 'flex';
    document.getElementById('treasury-key').focus();
  }

  function authorizePayment() {
    if (!isAdmin) return;
    const input = document.getElementById('treasury-key').value.trim();
    const statusEl = document.getElementById('auth-status');
    
    if (input === KEY_ADMIN) {
      isAuthorized = true;
      closeAuthModal();
      renderTable();
    } else {
      statusEl.textContent = "‚ùå Clave incorrecta";
    }
  }

  function markAsPaid(index) {
    if (!isAdmin || !isAuthorized) return;
    const item = currentData[index];
    const total = item.downloads * 1.275;
    item.paid = total; // ‚úÖ Actualizaci√≥n real
    renderTable();
  }

  // === Exportar CSV real ===
  function exportCSV() {
    if (!currentData || currentData.length === 0) {
      alert("‚ö†Ô∏è No hay datos para exportar.");
      return;
    }

    let csvContent = "ID,Compositor,Obras,Descargas,Adeudado,Pagado,Total\n";
    currentData.forEach((item, idx) => {
      const total = item.downloads * 1.275;
      const pending = total - item.paid;
      const row = [
        idx + 1,
        `"${item.name.replace(/"/g, '""')}"`,
        item.works || '‚Äî',
        item.downloads,
        pending.toFixed(2),
        item.paid.toFixed(2),
        total.toFixed(2)
      ];
      csvContent += row.join(",") + "\n";
    });

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    const timestamp = new Date().toISOString().slice(0,10);
    link.download = `nebulaudio_socios_${timestamp}.csv`;
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // Inicializaci√≥n
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => document.getElementById('access-key')?.focus(), 100);
  });
</script>
</body>
</html>
